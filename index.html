<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nunox - UNO 1v1</title>

  <style>
    body {
      margin: 0;
      background: #121212;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }

    #game {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    .deck, .discard {
      width: 120px;
      height: 180px;
      border-radius: 12px;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      box-shadow: 0 0 10px #000;
      background-size: cover;
    }

    .deck {
      left: calc(50% - 170px);
      background-image: url('back.png');
    }

    .discard {
      right: calc(50% - 170px);
      background-color: #222;
    }

    #player-hand, #ai-hand {
      position: absolute;
      display: flex;
      gap: 10px;
    }

    #player-hand { bottom: 20px; }
    #ai-hand { top: 20px; }

    .card {
      width: 110px;
      height: 165px;
      background-size: cover;
      border-radius: 10px;
      transition: transform 0.25s;
      cursor: pointer;
    }

    .card:hover { transform: scale(1.1); }
  </style>

  <!-- ======= SOUND EFFECTS ======= -->
  <audio id="snd-draw" src="draw.mp3"></audio>
  <audio id="snd-play" src="play.mp3"></audio>
  <audio id="snd-error" src="error.mp3"></audio>
  <audio id="snd-uno" src="uno.mp3"></audio>
  <audio id="snd-bgm" src="bgm.mp3" loop></audio>

</head>
<body>

<div id="game">
  <div id="deck" class="deck"></div>
  <div id="discard" class="discard"></div>

  <div id="ai-hand"></div>
  <div id="player-hand"></div>
</div>

<script>
/* === SOUND SYSTEM === */
const SFX = {
  draw: document.getElementById("snd-draw"),
  play: document.getElementById("snd-play"),
  error: document.getElementById("snd-error"),
  uno: document.getElementById("snd-uno"),
  bgm: document.getElementById("snd-bgm")
};

function playSFX(type){
  SFX[type].currentTime = 0;
  SFX[type].play();
}

document.body.addEventListener("click", () => {
  SFX.bgm.volume = 0.35;
  SFX.bgm.play();
}, { once: true });

/* === GAME LOGIC === */
let deck = [];
let player = [];
let ai = [];
let discard = [];

function loadDeck(){
  const colors = ["red","yellow","green","blue"];
  const nums = [...Array(10).keys()];

  colors.forEach(c => {
    nums.forEach(n => {
      deck.push({
        color: c,
        value: n,
        file: `${c}_${n}.png`
      });
    });
  });

  deck.sort(() => Math.random() - 0.5);
}

function drawCard(target){
  if(deck.length === 0){
    playSFX("error");
    return;
  }
  playSFX("draw");
  target.push(deck.pop());
  render();
}

function playCard(index){
  let card = player[index];
  discard.push(card);
  player.splice(index, 1);
  playSFX("play");

  render();
  setTimeout(aiTurn, 700);
}

function aiTurn(){
  const top = discard[discard.length - 1];
  const match = ai.find(c => c.color === top.color || c.value === top.value);

  if(match){
    ai.splice(ai.indexOf(match),1);
    discard.push(match);
    playSFX("play");
  } else {
    drawCard(ai);
  }
  render();
}

function render(){
  const ph = document.getElementById("player-hand");
  const ah = document.getElementById("ai-hand");
  const dis = document.getElementById("discard");

  ph.innerHTML = "";
  ah.innerHTML = "";

  player.forEach((c, i) => {
    let el = document.createElement("div");
    el.className = "card";
    el.style.backgroundImage = `url('${c.file}')`;
    el.onclick = () => playCard(i);
    ph.appendChild(el);
  });

  ai.forEach(() => {
    let el = document.createElement("div");
    el.className = "card";
    el.style.backgroundImage = `url('back.png')`;
    ah.appendChild(el);
  });

  if(discard.length > 0){
    dis.style.backgroundImage = `url('${discard[discard.length - 1].file}')`;
  }
}

/* === INIT === */
loadDeck();
for(let i=0;i<5;i++){
  drawCard(player);
  drawCard(ai);
}
render();
</script>

</body>
</html>
